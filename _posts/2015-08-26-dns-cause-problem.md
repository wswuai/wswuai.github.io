---
layout: post
title:  "记一次DNS引发的Bug"
date:   2015-08-26  16:14:47
categories: python
tags: python elasticsearch
---


公司有一个邮件群发的服务，近期将邮件群发的服务日志接入到公司的Hadoop日志收集平台，

Hadoop已经有一个RESTful的HTTP封装接口，我的业务代码需要频繁的调用这个HTTP接口。

早上邮件服务公司打电话过来，说他们的消息队列已经快满了，原因是我们这个接口调用返回的太慢。

我的服务的响应时间超过*10s*...

查看日志发现， 由于我的这个接口内部实现是阻塞的调用HTTP接口，

而那个接口时而300ms返回，时而5s才返回，时而10s才返回，导致整个服务被远程调用堵死。

赶紧改变实现方式，使用异步+HTTP连接池的方式来调用HTTP接口。

发现处理时间缩短为3ms，但还是有几百毫秒和秒级的返回。

看来事情还没完。

最后，发现Linux的DNS配置为8.8.8.8 而由于你懂的的原因，8.8.8.8的返回常被干扰。

改为114.114.114.114，问题解决。

真是X了.
